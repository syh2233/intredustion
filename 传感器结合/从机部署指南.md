# ESP32从机部署指南

## 📋 硬件连接

### 传感器接线
- **火焰传感器**: GPIO14 (模拟输入)
- **MQ2烟雾传感器**:
  - AO (模拟输出) → GPIO34
  - DO (数字输出) → GPIO2
  - VCC → 5V
  - GND → GND
- **状态指示灯**: GPIO5 (LED阳极→GPIO5, 阴极→GND, 串联220Ω电阻)

### 电源要求
- 工作电压: 5V (推荐使用USB供电)
- MQ2传感器预热时间: 24-48小时
- 注意MQ2输出电压必须≤3.3V (建议使用电压分压器)

## 🔧 软件配置

### 1. 修改配置文件
编辑 `slave_config.py` 文件：

```python
# 修改从机ID和位置信息
SLAVE_ID = "esp32_slave_01"
SLAVE_NAME = "从机-01"
LOCATION = "宿舍A栋101"

# 修改WiFi配置
WIFI_SSID = "你的WiFi名称"
WIFI_PASSWORD = "你的WiFi密码"

# 修改主机IP地址 (重要!)
HOST_IP = "192.168.1.100"  # 改为实际的主机IP
```

### 2. 获取主机IP地址
在主机电脑上运行：
- **Windows**: `ipconfig`
- **Linux/Mac**: `ifconfig` 或 `ip addr`

### 3. 上传程序到ESP32
使用Thonny IDE：
1. 连接ESP32到电脑
2. 打开 `esp32_slave.py`
3. 点击运行按钮或保存到设备

## 🚀 启动顺序

### 主机启动
1. 确保主机连接到同一WiFi网络
2. 运行主机接收程序：
```bash
python host_udp_receiver.py
```
3. 确认UDP服务器启动成功

### 从机启动
1. 上传程序到ESP32
2. 上电启动从机
3. 观察串口输出，确认WiFi连接成功
4. 确认数据发送正常

## 📊 监控和调试

### 主机端监控
主机程序会显示：
- 从机连接状态
- 实时传感器数据
- 警报信息
- 数据库记录状态

### 从机端调试
观察ESP32串口输出：
- WiFi连接状态
- 传感器读数
- 数据发送结果
- LED状态指示

### LED状态说明
- **熄灭**: 正常状态
- **慢闪**: 警告状态
- **快闪**: 警报状态
- **常亮**: 系统错误

## 🔍 故障排除

### WiFi连接问题
```
问题: WiFi连接失败
解决:
1. 检查WiFi名称和密码
2. 确保路由器正常工作
3. 检查ESP32天线连接
```

### 数据发送问题
```
问题: 数据发送失败
解决:
1. 检查主机IP地址是否正确
2. 确认主机程序正在运行
3. 检查网络防火墙设置
4. 确认UDP端口8888未被占用
```

### 传感器读数异常
```
问题: 传感器读数异常
解决:
1. 检查传感器接线
2. 确认传感器供电正常
3. MQ2传感器需要预热24-48小时
4. 检查电压分压器(如使用5V供电)
```

### 数据库问题
```
问题: 数据库创建失败
解决:
1. 检查磁盘空间
2. 确认程序有写入权限
3. 手动删除数据库文件重试
```

## 📈 性能优化

### 网络优化
- 将从机放置在WiFi信号良好的位置
- 避免过多的WiFi干扰
- 考虑使用WiFi信号增强器

### 电源优化
- 使用稳定的5V电源
- 添加电容滤波
- 避免电源线路过长

### 传感器优化
- 定期校准传感器
- 保持传感器清洁
- 避免环境干扰

## 🔒 安全注意事项

1. **电气安全**: 确保所有接线正确，避免短路
2. **防火安全**: MQ2传感器工作时可能发热，保持通风
3. **网络安全**: 不要在公共WiFi网络中使用
4. **数据安全**: 定期备份数据库文件

## 📞 技术支持

如遇到问题，请检查：
1. 本指南的故障排除部分
2. 串口输出的错误信息
3. 主机程序的日志文件
4. 网络连接状态

## 📝 维护记录

建议记录：
- 从机安装日期和位置
- 传感器校准日期
- 维护和故障处理记录
- 软件更新记录